# 数据转换

&emsp;&emsp;在基本绑定中，信息在从源到目标的传递过程中没有任何变化。这看起来是符合逻辑的，但我们并不总是希望出现这种行为。通常，数据源使用的是低级表达方式，我们可能不希望直接在用户界面中使用这种低级表达方式。例如，可能希望使用更便于读取的字符串来代替数字编码，数字需要被削减到合适的尺寸，日期需要使用长格式显示等。如果是这样的话，就需要有一种方法将这些数值转换为恰当的显示形式。并且如果正在使用双向绑定，还需要进行反向转换一—获取用户提供的数据并将它们转换到适于在恰当的数据对象中保存的表示形式。  

&emsp;&emsp;幸运的是，WPF提供了两个工具，可为您提供帮助：

* **字符串格式化。**使用该功能可以通过设置Binding.StringFormat 属性对文本形式的数据进行转换一—例如包含日期和数字的字符串。对于至少一半的格式化任务，字符串格式化是一种便捷的技术。
* **值转换器。**该功能更强大（有时更复杂），使用该功能可将任意类型的源数据转换为任意类型的对象表示，然后可传递到关联的控件。  

接下来将分析这两种方法。

## 1使用StringFormat属性

&emsp;&emsp;为格式化需要显示为文本的数字，字符串格式化堪称完美工具。例如，分析在上一章介绍的Product类的UnitCost 属性。UnitCost存储为小数，因此当在文本框中显示时，可能会看到类似3.9900的数值。这种显示格式不仅显示了比看起来更多的小数部分，而且缺少货币符号。更直观的表示方式应当是货币格式的数值$3.99。  

&emsp;&emsp;最简单的解决方法是设置Binding.StringFormat属性。在即将在控件中显示之前，WPF将使用格式字符串将原始文本转换为显示值。同样重要的是，WPF在大多数情况下将使用该字符串执行反向转换，获取所有编辑后的数据并使用编辑后的数据更新绑定的属性。  

&emsp;&emsp;当设置Binding.StringFormat属性时，使用标准的.NET格式字符串，具体形式为{0：C}。其中，0代表第一个数值，C引用希望应用的格式字符串——对于这个示例，它是标准的本地专用的货币格式。在我们的计算机上，该格式将3.99转换为$3.99。整个表达式被包含到一对花括号中。  

&emsp;&emsp;下面列举一个示例，该例为UnitCost字段应用格式字符串，从而使其显示为货币值：  

```C#
<TextBox Margin="5"Grid. Row="2"Grid. Column="1"
Text="{ Binding Path=UnitCost, StringFormat={}{0:C}}">
</TextBox>
```  

&emsp;&emsp;您可能注意到了，StringFormat属性的值以花括号}开头。完整值是}{0：C}而不是{0：C}。为了转义字符串，需要在开始处使用稍微笨拙的花括号对。否则，XAML解析器可能会被{0：C}
开头的花括号所迷惑。
&emsp;&emsp;顺便提一下，只有当StringFormat值以花括号开头时才需要，转义序列。分析下面的示例，该例在每个格式化的数值之前添加了一个字面文本序列：
